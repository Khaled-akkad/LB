(function(){function log(message){console&&console.log&&console.log("LB: "+message)}function initLBBookmarklet(){(window.lbBookmarklet=function(){function getNewBodyContent(callback){var sendData=encodeURIComponent(window.location.href);log("Using "+sendData+" for server content lookup"),$.getJSON("http://{ENVIRONMENT}/api/v1/injectgenericas/{URL_SELECTOR}/?url="+sendData+"&apikey={APIKEY}&callback=?",function(data){callback(null,data.content)}).fail(function(request,textStatus,error){var err=textStatus+", "+error;callback(err)})}function handleGenericas(event){log("handleGenericas");var atcCodes=$(this).attr("data-atcid"),medName=$(this).text();atcCodes=atcCodes.indexOf(",")>-1?atcCodes.split(","):[atcCodes];var atcTitles=$(this).attr("data-atctitles");if(atcTitles=atcTitles.indexOf("##")>-1?atcTitles.split("##"):[atcTitles],$(this).attr("data-original-title")===void 0){for(var popoverPlacement="bottom",content='<div class="lb"><div class="lb" style="float: left !important; width: 47% !important;"><h4 class="lb">Preparat</h4>',i=0;i<atcCodes.length;i++){var atcCode=atcCodes[i];content+='<h6 class="lb '+atcCode+'">'+atcTitles[i].replace(/\-\-/g," - ").replace(/_/g," ")+'</h6><ul class="lb '+atcCode+' nav nav-tabs nav-stacked"><li class="lb loading"><a class="lb" href="#"><i class="lb icon icon-refresh icon-spin"></i> Hämtar rubriker...</a></ul>'}content+='</div><div class="lb" style="float: left !important; width: 47% !important; margin-left: 5% !important;"><h4 class="lb">Innehåll</h4><ul class="lb search-'+atcCodes.join("")+' nav nav-tabs nav-stacked"><li class="lb loading"><a class="lb" href="#"><i class="lb icon icon-refresh icon-spin"></i> Söker...</a></ul></div>';var title='Preparatinformation från <a class="lb" href="http://{ENVIRONMENT}" target="_blank">Läkemedelsboken</a>';title+='<button type="button" class="lb close" data-dismiss="clickover">&times;</button>',lb.tipCounter++;var tipId="tip_"+lb.tipCounter,popoverWidth=500;$(document).width()<popoverWidth-30&&(popoverWidth=$(document).width()-30),$(this).clickover({placement:popoverPlacement,content:content,animation:!0,title:title,width:popoverWidth+"px",html:!0,allow_multiple:!0,tip_id:tipId,esc_close:0,onShown:function(){function onCompletedAtcCodes(){$("#"+tipId).find("h6").length===0&&$("#"+tipId).find(".popover-content").html('<h5 class="lb"><i class="lb icon icon-info-sign"></i> Tyvärr hittades inga preparat för denna rubrik</h5>')}var completionCounter=0;lb.getBoxSearch(medName,function(err,results){var currentTherapyMenu=$("ul.search-"+atcCodes.join(""));if(currentTherapyMenu.find(".loading").remove(),err)currentBoxMenu.append('<li class="lb"><a class="lb" href="#"><i class="lb icon icon-info-sign"></i> Sökningen misslyckades</a></li>');else if(results.length===0)currentTherapyMenu.append('<li class="lb"><a class="lb" href="#"><i class="lb icon icon-info-sign"></i> Substansen nämns inte i några informationsrutor</a></li>'),currentTherapyMenu.menu("refresh");else{results.length>5&&(results.length=5);for(var i=0;i<results.length;i++){var item=results[i],titlePath=item.titlePath_HL!==void 0?item.titlePath_HL:item.titlePath;titlePath.indexOf(" && ")>-1&&(titlePath=titlePath.split(" && "),titlePath.pop(),titlePath=titlePath.join(" &#187; "));var title=item.title_HL!==void 0?item.title_HL:item.title;currentTherapyMenu.append($('<li class="lb"><a class="lb boxSearchResult" target="_blank" href="http://{ENVIRONMENT}/'+item.chapter+"?search=&iso=false&imo=false&nplId=null&id="+item.id+'"><i class="lb icon '+lb.getIcon(item.type)+'"></i> <strong class="lb">'+title+'</strong><br class="lb"><small class="lb">'+titlePath+'</small><div class="lb">'+item.content_HL+"</div></a></li>"))}}});for(var i=0;i<atcCodes.length;i++){var atcCode=atcCodes[i];lb.getATCItems(atcCode,function(err,results){var currentATCMenu=$("ul."+results.atcCode);if(currentATCMenu.find(".loading").remove(),err)currentATCMenu.append('<li class="lb"><a class="lb" href="#"><i class="lb icon icon-info-sign"></i> Kunde inte hitta rubriker</a></li>');else{for(var noInfoItems="",i=0;i<results.data.length;i++){var item=results.data[i];if(item.hasChildren)currentATCMenu.append('<li class="lb" id="'+tipId+"_"+item.id+'"><a target="_blank" href="http://{ENVIRONMENT}/atc/'+item.id+'" data-indentation="0" class="lb atcCodeInPopover"><i class="lb icon icon-plus-sign-alt">+</i><i class="lb icon icon-angle-down pull-right"></i> <strong class="lb">'+item.text+"</strong></a></li>");else if(item.children&&item.children.length>0)for(var j=0;j<item.children.length;j++){var productItem=item.children[j],images="";if(productItem.images)for(var x=0;x<productItem.images.length;x++)images+='<img src="http://{ENVIRONMENT}'+productItem.images[x]+'" class="lb img-polaroid pull-right" style="width: 15px !important; height: 15px !important; margin-right: 5px !important;" />';var productInfo=productItem.text.split(",");0===j&&(productInfo[0]='<strong class="lb">'+productInfo[0]+"</strong>"),productInfo=productInfo.join(",");var extraIndent=0;productItem.noinfo===!0?noInfoItems+="<li"+(productItem.noinfo===!0?' class="lb ui-state-disabled"':' class="lb"')+'><a target="_blank" href="http://{ENVIRONMENT}/?imo=true&nplId='+productItem.id+'" data-product-id="'+productItem.id+'" class="lb inlineProduct" '+(extraIndent>0?' style="padding-left: '+extraIndent+'px !important;"':"")+">"+images+productInfo+"</a></li>":currentATCMenu.append("<li"+(productItem.noinfo===!0?' class="lb ui-state-disabled"':' class="lb"')+'><a target="_blank" href="http://{ENVIRONMENT}/?imo=true&nplId='+productItem.id+'" data-product-id="'+productItem.id+'" class="lb inlineProduct" '+(extraIndent>0?' style="padding-left: '+extraIndent+'px !important;"':"")+">"+images+productInfo+"</a></li>")}}noInfoItems.length>0&&currentATCMenu.append(noInfoItems),results.data.length===0&&($("h6."+results.atcCode).remove(),currentATCMenu.remove())}++completionCounter,completionCounter===atcCodes.length&&onCompletedAtcCodes()})}}});var that=this;setTimeout(function(){$(that).click()},10)}event.preventDefault()}function handleAtcCodeInPopover(event){event.preventDefault(),event.stopPropagation();var currentAnchor=$(this);if(currentAnchor.attr("data-already-loaded")!==void 0){var id=currentAnchor.parent().attr("id"),indentationLevel=parseInt(currentAnchor.attr("data-indentation"));return currentAnchor.parent().nextAll().each(function(index,element){var firstAnchor=$(element).find("a").first();return firstAnchor.attr("data-indentation")!==void 0&&parseInt(firstAnchor.attr("data-indentation"))>indentationLevel?($(element).remove(),void 0):!1}),currentAnchor.removeAttr("data-already-loaded"),currentAnchor.find("i.icon-minus-sign-alt").removeClass("icon-minus-sign-alt").addClass("icon-plus-sign-alt").html("+"),void 0}currentAnchor.attr("data-already-loaded","true");var id=currentAnchor.parent().attr("id"),atcCode=id.split("_");atcCode=atcCode[atcCode.length-1];var tipId=id.split("_");tipId.pop(),tipId=tipId.join("_"),currentAnchor.find("i.icon-plus-sign-alt").removeClass("icon-plus-sign-alt").addClass("icon-refresh"),currentListItem=currentAnchor.parent();var indentationLevel=parseInt(currentAnchor.attr("data-indentation")),indentationPixels=25*(indentationLevel+1)+"px";lb.getATCItems(atcCode,function(err,results){if(currentAnchor.find("i.icon-refresh").removeClass("icon-refresh").addClass("icon-minus-sign-alt").html("-"),err){currentAnchor.find("i.icon-minus-sign-alt").removeClass("icon-minus-sign-alt").addClass("icon-info-sign").html("(i)");var oldText=currentAnchor.text();currentAnchor.find("strong").text('Kunde inte hämta information för "'+oldText+'"')}else{for(var content="",noInfoItems="",i=0;i<results.data.length;i++){var item=results.data[i];if(item.hasChildren)content+='<li class="lb" id="'+tipId+"_"+item.id+'"><a target="_blank" href="http://{ENVIRONMENT}/atc/'+item.id+'" data-indentation="'+(indentationLevel+1)+'" class="lb atcCodeInPopover" style="padding-left: '+indentationPixels+' !important;"><i class="lb icon icon-plus-sign-alt">+</i><i class="icon icon-angle-down pull-right"></i> <strong class="lb">'+item.text+"</strong></a></li>";else if(item.children&&item.children.length>0)for(var j=0;j<item.children.length;j++){var productItem=item.children[j],images="";if(productItem.images)for(var x=0;x<productItem.images.length;x++)images+='<img src="http://{ENVIRONMENT}'+productItem.images[x]+'" class="lb img-polaroid pull-right" style="width: 15px !important; height: 15px !important; margin-right: 5px !important;" />';var productInfo=productItem.text.split(",");0===j&&(productInfo[0]='<strong class="lb">'+productInfo[0]+"</strong>"),productInfo=productInfo.join(",");var extraIndent=0;productItem.noinfo===!0?noInfoItems+="<li"+(productItem.noinfo===!0?' class="lb ui-state-disabled"':' class="lb"')+'><a target="_blank" href="http://{ENVIRONMENT}/?imo=true&nplId='+productItem.id+'" data-product-id="'+productItem.id+'" class="lb inlineProduct" data-indentation="'+(indentationLevel+1)+'" style="padding-left: '+(parseInt(indentationPixels)+extraIndent)+'px !important;">'+images+productInfo+"</a></li>":content+="<li"+(productItem.noinfo===!0?' class="lb ui-state-disabled"':' class="lb"')+'><a target="_blank" href="http://{ENVIRONMENT}/?imo=true&nplId='+productItem.id+'" data-product-id="'+productItem.id+'" class="lb inlineProduct" data-indentation="'+(indentationLevel+1)+'" style="padding-left: '+(parseInt(indentationPixels)+extraIndent)+'px !important;">'+images+productInfo+"</a></li>"}}content+=noInfoItems,""!==content?currentListItem.after(content):currentListItem.after('<li class="lb"><a class="lb" style="padding-left: '+indentationPixels+' !important;"><i class="lb icon icon-info-sign"></i> Det finns inga underliggande preparat</a></li>')}})}initClickOver(),$.important(),log("Running"),log("Searching for substances..."),getNewBodyContent(function(err,data){if(err)log("Could not find any substances."),log(err);else if(""===data)log("Answer from server was empty.");else{$("body").on("click","a.inlineGenerica",handleGenericas),$("body").on("click","a.atcCodeInPopover",handleAtcCodeInPopover),$("head").append('<link rel="stylesheet" href="http://{ENVIRONMENT}/api/v1/injectgenericas/lb.injectgenericas.css" id="injectGenericasStyles">');var selectedElement=$("{SELECTOR}");selectedElement.length>0&&(selectedElement=selectedElement.first(),selectedElement.html(data),log("Done loading substances."))}});var lb={tipCounter:0,getATCItems:function(parentId,callback){var out={atcCode:parentId};$.getJSON("http://{ENVIRONMENT}/api/v1/atctree?parentid="+encodeURIComponent(parentId)+"&callback=?",function(results){out.data=results,callback(null,out)}).error(function(){callback("Kunde inte hitta rubriker",out)})},getBoxSearch:function(medName,callback){var out=[];$.getJSON("http://{ENVIRONMENT}/api/v1/contentsearch?search="+encodeURIComponent(medName)+"&callback=?",function(results){out=results,callback(null,out)}).error(function(){callback("Preparatet kunde inte hittas",out)})},getIcon:function(){return""}}})()}function initClickOver(){(function($){"use strict";function cssDeclaration(property,value,rules){function regexDeclaration(property){return new RegExp("(?:^|\\s|;)("+property+")\\s*:\\s*([^;]*(?:;|$))","i")}function find(property,rules){var match=rules.match(regexDeclaration(property));return match&&(match[0]=match[0].replace(/^;/,"")),match}var oldDeclaration,newDeclaration,makeImportant;return rules=rules||"",oldDeclaration=find(property,rules),null===value?newDeclaration="":"string"==typeof value&&(newDeclaration=property+":"+value+" !important;"),oldDeclaration?("boolean"==typeof value&&(makeImportant=value,newDeclaration=$.important(property+":"+oldDeclaration[2],makeImportant)),rules=rules.replace(oldDeclaration[0],newDeclaration)):"undefined"!=typeof newDeclaration&&(rules=$.trim(rules),""!==rules&&(rules.slice(-1)!==";"&&(rules+=";"),rules+=" "),rules+=newDeclaration),rules}function toImportant(rulesets,makeImportant){var re=toImportant.re;return re||(re=toImportant.re=/\s*(! ?important)?[\s\r\t\n]*;/g),makeImportant===!1?rulesets.replace(re,";"):rulesets.replace(re,function($0,$1){return $1?$0:" !important;"})}function htmlStylesToImportant(html,makeImportant){var re=htmlStylesToImportant.re;return re||(re=htmlStylesToImportant.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g),html.replace(re,function($0,rulesets){return toImportant(rulesets,makeImportant)})}var important=!1,original={},controller={},replacement=$.each({css:function(property,value){var rulesHash={},elem=$(this),rules=elem.attr("style");if("string"==typeof property){if("undefined"==typeof value)return original.css.apply(this,arguments);rulesHash[property]=value}else{if("object"!=typeof property)return elem;rulesHash=property}return $.each(rulesHash,function(property,value){rules=cssDeclaration(property,value,rules)}),elem.attr("style",rules)}},function(method,fn){original[method]=$.fn[method],fn.overridden=!0,controller[method]=function(){var args=$.makeArray(arguments),lastArg=args[args.length-1],elem=$(this);return lastArg===!0?fn.apply(elem,args.slice(0,-1)):important&&lastArg!==!1?fn.apply(elem,args):original[method].apply(elem,args)}});$.extend($.fn,controller),$.important=$.extend(function(){var makeImportant,cacheImportant,args=$.makeArray(arguments);if(typeof args[0]=="string"){if(typeof args[1]=="undefined"||typeof args[1]=="boolean")return makeImportant=args[1]!==!1,/<\w+.*>/.test(args[0])?htmlStylesToImportant(args[0],makeImportant):toImportant(args[0],makeImportant)}else $.isFunction(args[0])?(cacheImportant=important,$.important.status=important=!0,args[0].call(this),$.important.status=important=cacheImportant):(typeof args[0]=="undefined"||typeof args[0]=="boolean")&&($.important.status=important=args[0]!==!1);return important},{status:important,noConflict:function(){return $.each(original,function(method,fn){$.fn[method]=fn}),replacement},declaration:cssDeclaration}),$.fn.important=function(method){var property,makeImportant,fn,elem=$(this),args=$.makeArray(arguments).concat(!0),nodeName=elem.data("nodeName");if("undefined"==typeof method||"boolean"==typeof method){if(nodeName||(nodeName=elem.attr("nodeName").toLowerCase(),elem.data("nodeName",nodeName)),"style"===nodeName){makeImportant=method!==!1,elem.html(toImportant(elem.html(),makeImportant));var stylesheet=elem.attr("sheet");stylesheet&&stylesheet.cssRules&&$.each(stylesheet.cssRules,function(i,rule){rule.type===CSSRule.STYLE_RULE&&(rule.style.cssText=$.important(rule.style.cssText,makeImportant))})}else elem.attr("style",$.important(elem.attr("style"),method));return elem}return"object"==typeof method?(args.unshift("css"),elem.important.apply(this,args)):("string"==typeof method?$.isFunction(controller[method])?(args=args.slice(1),controller[method].apply(elem,args)):(typeof args[1]=="undefined"||typeof args[1]=="boolean")&&(property=method,makeImportant=args[1]!==!1,elem.attr("style",cssDeclaration(property,makeImportant,elem.attr("style")))):$.isFunction(method)&&(fn=method,$.important.call(this,fn)),elem)}})(window.jQuery),!function($){"use strict";var Tooltip=function(element,options){this.init("tooltip",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut;this.type=type,this.$element=$(element),this.options=this.getOptions(options),this.enabled=!0,this.options.trigger!="manual"&&(eventIn=this.options.trigger=="hover"?"mouseenter":"focus",eventOut=this.options.trigger=="hover"?"mouseleave":"blur",this.$element.on(eventIn,this.options.selector,$.proxy(this.enter,this)),this.$element.on(eventOut,this.options.selector,$.proxy(this.leave,this))),this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(options){return options=$.extend({},$.fn[this.type].defaults,options,this.$element.data()),options.delay&&typeof options.delay=="number"&&(options.delay={show:options.delay,hide:options.delay}),options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);self.options.delay&&self.options.delay.show?(self.hoverState="in",setTimeout(function(){self.hoverState=="in"&&self.show()},self.options.delay.show)):self.show()},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);self.options.delay&&self.options.delay.hide?(self.hoverState="out",setTimeout(function(){self.hoverState=="out"&&self.hide()},self.options.delay.hide)):self.hide()},show:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp;if(this.hasContent()&&this.enabled){$tip=this.tip(),this.setContent(),this.options.animation&&$tip.addClass("fade"),placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement,inside=/in/.test(placement);var parent=document.body;switch(this.options.parentElement&&(parent=$(this.options.parentElement)),$tip.remove().css({top:0,left:0,display:"block"}).appendTo(inside?this.$element:parent),pos=this.getPosition(inside),this.options.parentElement&&(pos.top=this.$element.position().top+this.options.parentElement.scrollTop(),pos.left=this.$element.position().left),actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,inside?placement.split(" ")[1]:placement){case"bottom":tp={top:pos.top+pos.height+"px",left:pos.left+pos.width/2-actualWidth/2+"px"};break;case"top":tp={top:pos.top-actualHeight+"px",left:pos.left+pos.width/2-actualWidth/2+"px"};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2+"px",left:pos.left-actualWidth+"px"};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2+"px",left:pos.left+pos.width+"px"}}var indent=20,maxRightPosition=$(window).width()-indent,maxLeftPosition=indent;this.options.parentElement&&(indent=2,maxRightPosition=this.options.parentElement.width()-indent,maxLeftPosition=indent),parseInt(tp.left)+parseInt(actualWidth)>maxRightPosition&&(tp.left=maxRightPosition-indent-actualWidth+"px",$tip.find(".arrow").css("left",pos.left+pos.width/2-parseInt(tp.left)+"px")),parseInt(tp.left)<maxLeftPosition&&(tp.left=maxLeftPosition+"px",$tip.find(".arrow").css("left",pos.left+pos.width/2-parseInt(tp.left)+"px")),$tip.css(tp).addClass(placement).addClass("in")}},setContent:function(){var $tip=this.tip();$tip.find(".tooltip-inner").html(this.getTitle()),$tip.removeClass("fade in top bottom left right")},hide:function(){function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).remove()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout),$tip.remove()})}var $tip=this.tip();$tip.removeClass("in"),$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.remove()},fixTitle:function(){var $e=this.$element;($e.attr("title")||typeof $e.attr("data-original-title")!="string")&&$e.attr("data-original-title",$e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(inside){return $.extend({},inside?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var title,$e=this.$element,o=this.options;return title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title),title=title.toString().replace(/(^\s*|\s*$)/,"")},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}},$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("tooltip"),options="object"==typeof option&&option;data||$this.data("tooltip",data=new Tooltip(this,options)),"string"==typeof option&&data[option]()})},$.fn.tooltip.Constructor=Tooltip,$.fn.tooltip.defaults={animation:!0,delay:0,selector:!1,placement:"top",trigger:"hover",title:"",parentElement:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery),!function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype,{constructor:Popover,setContent:function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();$tip.find(".popover-title")[$.type(title)=="object"?"append":"html"](title),$tip.find(".popover-content > *")[$.type(content)=="object"?"append":"html"](content),$tip.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var content,$e=this.$element,o=this.options;return content=$e.attr("data-content")||(typeof o.content=="function"?o.content.call($e[0]):o.content),content=content.toString().replace(/(^\s*|\s*$)/,"")},tip:function(){return this.$tip||(this.$tip=$(this.options.template)),this.$tip}}),$.fn.popover=function(option){return this.each(function(){var $this=$(this),data=$this.data("popover"),options="object"==typeof option&&option;data||$this.data("popover",data=new Popover(this,options)),"string"==typeof option&&data[option]()})},$.fn.popover.Constructor=Popover,$.fn.popover.defaults=$.extend({},$.fn.tooltip.defaults,{placement:"right",content:"",template:'<div class="lb popover cleanslate"><div class="lb arrow"></div><div class="lb popover-inner"><h3 class="lb popover-title"></h3><div class="lb popover-content"><p class="lb"></p></div></div></div>'})}(window.jQuery),!function($){"use strict";var Clickover=function(element,options){this.cinit("clickover",element,options)};Clickover.prototype=$.extend({},$.fn.popover.Constructor.prototype,{constructor:Clickover,cinit:function(type,element,options){this.attr={},this.attr.me=(Math.random()*10+"").replace(/\D/g,""),this.attr.click_event_ns="click."+this.attr.me,options||(options={}),options.trigger="manual",this.init(type,element,options),this.$element.on("click",this.options.selector,$.proxy(this.clickery,this))},clickery:function(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.options.width&&this.tip().css("width",this.options.width),this.options.height&&this.tip().css("height",this.options.height),this.options.tip_id&&this.tip().attr("id",this.options.tip_id),this.options.class_name&&this.tip().addClass(this.options.class_name),this[this.isShown()?"hide":"show"](),this.isShown()){var that=this;this.options.global_close&&$("body").on(this.attr.click_event_ns,function(e){that.tip().has(e.target).length||that.clickery()}),this.options.esc_close&&$(document).bind("keyup.clickery",function(e){e.keyCode==27&&that.clickery()}),!this.options.allow_multiple&&$("[data-clickover-open=1]").each(function(){$(this).data("clickover")&&$(this).data("clickover").clickery()}),this.$element.attr("data-clickover-open",1),this.tip().on("click",'[data-dismiss="clickover"]',$.proxy(this.clickery,this)),this.options.auto_close&&this.options.auto_close>0&&(this.attr.tid=setTimeout($.proxy(this.clickery,this),this.options.auto_close)),typeof this.options.onShown=="function"&&this.options.onShown.call(this),this.$element.trigger("shown")}else this.$element.removeAttr("data-clickover-open"),this.options.esc_close&&$(document).unbind("keyup.clickery"),$("body").off(this.attr.click_event_ns),typeof this.attr.tid=="number"&&(clearTimeout(this.attr.tid),delete this.attr.tid),typeof this.options.onHidden=="function"&&this.options.onHidden.call(this),this.$element.trigger("hidden")},isShown:function(){return this.tip().hasClass("in")},resetPosition:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp;if(this.hasContent()&&this.enabled){switch($tip=this.tip(),placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement,inside=/in/.test(placement),pos=this.getPosition(inside),actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,inside?placement.split(" ")[1]:placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}}$tip.css(tp)}},debughide:function(){(new Date).toString(),this.hide()}}),$.fn.clickover=function(option){return this.each(function(){var $this=$(this),data=$this.data("clickover"),options="object"==typeof option&&option;data||$this.data("clickover",data=new Clickover(this,options)),"string"==typeof option&&data[option]()})},$.fn.clickover.Constructor=Clickover,$.fn.clickover.defaults=$.extend({},$.fn.popover.defaults,{trigger:"manual",auto_close:0,global_close:1,esc_close:1,onShown:null,onHidden:null,width:null,height:null,tip_id:null,class_name:"clickover",allow_multiple:0})}(window.jQuery)}var minimumJQueryMajor=1,minimumJQueryMinor=11,preferredJQuery="1.11.1";if(log("Init jQuery check..."),window.jQuery!==void 0){var minJqueryMajor=parseInt(window.jQuery.fn.jquery.split(".")[0]),minJqueryMinor=parseInt(window.jQuery.fn.jquery.split(".")[1]);if(log("Current jQuery version is "+minJqueryMajor+"."+minJqueryMinor),minimumJQueryMajor>minJqueryMajor||minimumJQueryMajor>=minJqueryMajor&&minimumJQueryMinor>minJqueryMinor){log("Loading jQuery from cdn, version did not match...");var done=!1,script=document.createElement("script");script.src="http://ajax.googleapis.com/ajax/libs/jquery/"+preferredJQuery+"/jquery.min.js",script.onload=script.onreadystatechange=function(){done||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(log("Done loading jQuery."),done=!0,initLBBookmarklet())},document.getElementsByTagName("head")[0].appendChild(script)}else log("jQuery is fine"),done=!0,initLBBookmarklet()}else{log("Loading jQuery from cdn...");var done=!1,script=document.createElement("script");script.src="http://ajax.googleapis.com/ajax/libs/jquery/"+preferredJQuery+"/jquery.min.js",script.onload=script.onreadystatechange=function(){done||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(log("Done loading jQuery."),done=!0,initLBBookmarklet())},document.getElementsByTagName("head")[0].appendChild(script)}})();