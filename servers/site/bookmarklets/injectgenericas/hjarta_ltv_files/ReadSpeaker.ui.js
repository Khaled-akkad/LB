ReadSpeaker.ui=function(){var b=null,e=[],p=[],w=!1,r=function(g){g=g||window.event;g.returnValue=!1;if(g=g.originalEvent)g.cancelBubble=!0,g.returnValue=!1;g&&g.preventDefault&&g.preventDefault();g&&g.stopPropagation&&g.stopPropagation()},n=function(){rspkr.log("[rspkr.ui] Attempting to add click events.");var g=$rs.get("."+rspkr.ui.rsbtnClass+" a.rsbtn_play"),b=null;$rs.isArray(g)||(g=[g]);for(var a=0,f=g.length;a<f;a++)if($rs.unregEvent(g[a],"click",ReadSpeakerDefer.clickhandler),b=g[a]?$rs.getAttr(g[a],
"data-rsevent-id"):"_bogus_",rspkr.l.f.eq.store[b]&&rspkr.l.f.eq.store[b].click)rspkr.log("[rspkr.ui] Click event already existed on "+g[a],2);else{$rs.regEvent(g[a],"click",function(h){r(h);window.readpage(this)});rspkr.ui.addFocusHandler(g[a],!0,g[a].parentNode);rspkr.log("[rspkr.ui] Added click event to: "+g[a],1);try{$rs.getAttr(g[a],"role")||$rs.setAttr(g[a],"role","button")}catch(e){rspkr.log("[rspkr.ui] Could not add role attribute.",2)}}},x=function(){rspkr.log("[rspkr.ui] Initiating global callbacks");
rspkr.ui.rsbtnClass=rspkr.cfg.item("ui.rsbtnClass")||"rsbtn";window.readpage=function(g,a){rspkr.ui.initrun&&rspkr.ui.showPlayer(g,a)};window.rshlexit=function(g){(void 0===g||"false"===g)&&b.stop();setTimeout(function(){rspkr.c.dispatchEvent("onAfterSyncExit",window)},1E3)};window.rshlinit=m().sync.init;window.rshlsetContent=m().sync.setContent;window.rshlsetId=m().sync.setId;window.rshlsync=function(g,a){for(var b=g.split(","),f=a.split(","),h=0,i=g.length;h<i;h++)m().sync.execute(b[h],f[h])};var g=
rspkr.c.data.browser;g&&(/iphone|ipad|ios|android/i.test(g.OS)||"android"==g.name.toLowerCase())?$rs.regEvent(document.body,"touchstart",function(g){rspkr.c.data.setSelectedText(g);return!0}):($rs.regEvent(document.body,"mousedown",function(g){rspkr.ui.setPointerPos(g);return!0}),$rs.regEvent(document.body,"mouseup",function(a){"opera"===g.name.toLowerCase()?setTimeout(function(){rspkr.c.data.setSelectedText(a)},50):rspkr.c.data.setSelectedText(a);return!0}),$rs.regEvent(window,"mouseup",function(a){"opera"===
g.name.toLowerCase()?setTimeout(function(){rspkr.c.data.setSelectedText(a)},50):rspkr.c.data.setSelectedText(a);return!0}),$rs.regEvent(document.body,"keydown",rspkr.ui.setPointerPos),$rs.regEvent(document.body,"keyup",function(g){rspkr.c.data.setSelectedText(g);return!0}))},u=function(){document.removeEventListener?document.removeEventListener("click",window.ReadSpeakerDefer.clickhandler,!1):document.detachEvent&&document.detachEvent("onclick",window.ReadSpeakerDefer.clickhandler);if(ReadSpeakerDefer.deferred){var g=
ReadSpeakerDefer.deferred,a=null;if("a"!=g.tagName.toLowerCase()){for(a=g;"body"!=a.tagName.toLowerCase()&&!(a=a.parentNode,"a"==a.tagName.toLowerCase()););g=a}ReadSpeakerDefer.isRSLink(g)&&(rspkr.log("[rspkr.ui] Activating deferred element: "+g),$rs.removeClass(g.parentNode,"rsdeferred"),rspkr.ui.showPlayer(g));ReadSpeakerDefer.deferred=null}},v=null,c=function(){v&&$rs.isVisible(v)&&(rspkr.log("[rspkr.ui.updateFocus] "+v.outerHTML),t(v))},t=function(g){$rs.focus&&("function"==typeof $rs.focus&&
g)&&$rs.focus(g)},a=function(g){if("iconon"==rspkr.st.get("hlicon")&&!w){var a=p.push(new j)-1;p[a].id=a;p[a].show(g);w=!0}},f=function(){"iconon"==rspkr.st.get("hlicon")&&w&&(p.pop().hide(),w=!1)},j=function(){var g=0,a=0,b=null,f=52,e=null,h=null,i=null,c=function(h){h=h||b;$rs.addClass(h,rspkr.ui.rsbtnClass+" rspopup");rspkr.cfg.item("general.useCompactPopupButton")&&$rs.addClass(h,"rscompact")},j=function(g){$rs.unregEvent(b,"mouseout",k);window.clearTimeout(e);var a,f=b.clientWidth+10,c;h=rspkr.ui.showPlayer(i,
b,!0);c=h.getWidth();a=parseInt($rs.offset(b).left);if((a=rspkr.ui.viewport.width+$rs.scrollLeft(document)-a)<c)a=parseInt($rs.css(b,"left"))-(c-(f-10)),$rs.css(b,"left",a+"px");w=!1;$rs.unregEvent(i,"click",j);$rs.regEvent(i,"click",function(g){r(g);return h.restart()});r(g);return!1},k=function(){e||(e=window.setTimeout(function(){m()},rspkr.cfg.item("general.popupCloseTime")||2E3))},l=function(){e&&(window.clearTimeout(e),e=null)},q=function(h,g){var a=$rs.offset(document.body);$rs.css(b,{top:g-
a.top+"px",left:h-a.left+"px",width:f+"px"})},m=function(){$rs.css(b,{display:"none",top:0,left:0});l();p.splice(null,1);w=!1;b.parentElement.removeChild(b)},n=rspkr.c.findFirstRSButton(),b=document.createElement("div");b.id=rspkr.getID();b.innerHTML=rspkr.cfg.item("ui.popupbutton").join("");c();i=$rs.findIn(b,"a.rsbtn_play");i.href=n?n.href:null;n||(i.href=rspkr.cfg.item("general.popupHref"));var n=i.href.match(/lang=([^&;]*)/i).pop(),u=$rs.findIn($rs.get(b),"a.rsbtn_play span.rsbtn_text span");
u&&(u.textContent=u.innerText=rspkr.cfg.getPhrase("listen",n,"en_us"));$rs.setAttr(i,"title",rspkr.cfg.getPhrase("listentoselectedtext",n,"en_us"));$rs.regEvent(i,"click",j);document.body.appendChild(b);return{setPos:q,show:function(h){l(h);if(h&&"none"==$rs.css(b,"display")){var i=b.cloneNode(!0);i.id=rspkr.getID();$rs.css(i,{display:"block",position:"absolute",top:0,left:0});document.body.appendChild(i);f=$rs.outerWidth(i)+3;document.body.removeChild(i);i=h.pageX;h=h.pageY;a=h>rspkr.ui.pointerY?
h-$rs.scrollTop(document)+36>rspkr.ui.viewport.height-46?h-66:h+30:10>h-$rs.scrollTop(document)-66?h+30:h-51;g=10>i-$rs.scrollLeft(document)?i+10:i-$rs.scrollLeft(document)>rspkr.ui.viewport.width-(f+10)?rspkr.ui.viewport.width+$rs.scrollLeft(document)-(f+10):i+0;q(g,a)}$rs.regEvent(b,"mouseout",k);$rs.regEvent(b,"mouseover",l);k(null);c();$rs.css(b,"display","block")},hide:m,id:null}},k={update:function(g,a,f){"hlspeed"===g&&a!==f&&(g=g.replace("hl",""),rspkr.c.converter[g]&&"function"==typeof rspkr.c.converter[g]&&
(a=rspkr.c.converter[g](a)),rspkr.c.data[g]=a,b&&b.stop(),rspkr.pl.releaseAdapter())}},l=function(a,b,f,e,c,h){$rs.css(a,"background-color","rgb("+b+","+f+","+e+")");e<c?(e+=10,window.setTimeout(function(){l(a,b,f,e,c,h)},50)):h&&"function"===typeof h&&h.apply(a,[])},m=function(){return rspkr.XP?rspkr.XP:rspkr.HL};_expand=function(a){"string"==typeof a&&(a=$rs.get(a));$rs.isArray(a)||(a=[a]);var b=rspkr.cfg.getPhrases(rspkr.c.data.getParam("lang")),f=rspkr.c.data.browser,e=function(h){return $rs.closest(h,
"div."+rspkr.ui.rsbtnClass)},c=function(){k(this)},h=function(){var h=$rs.findIn(e(this),".rsbtn_play");$rs.removeClass(e(this),"rsstopped rsplaying rspaused rsexpanded");k(this);h.click()},i=function(){$rs.removeClass(e(this),"rsstopped rsplaying rspaused rsexpanded");k(this)},j=function(){var h=e(this);rspkr.ui.Lightbox.show(rspkr.st.getHTML(),rspkr.st.getButtons(),!0,function(){rspkr.c.dispatchEvent("onSettingsLoaded",window,[]);rspkr.cfg.execCallback("cb.ui.settingsopened",h)})},k=function(a){a=
e(a);$rs.unregEvent($rs.findIn(a,".rsbtn_pause"),"click",h);$rs.unregEvent($rs.findIn(a,".rsbtn_closer"),"click",i);$rs.unregEvent($rs.findIn(a,".rsbtn_settings"),"click",j);$rs.unregEvent($rs.findIn(a,".rsbtn_play"),"click",c);$rs.removeClass(a,"pre-expanded")},z;for(z in a){$rs.addClass(a[z],"rsexpanded rsstopped");var l=$rs.findIn(a[z],".rsbtn_powered");if(l){var q=$rs.findIn(l,".rsbtn_btnlabel"),n=b.speechenabled.match(/.*href="([^"]*)"/i).pop(),m=b.newwindow,p=document.createElement("p");p.innerHTML=
b.speechenabled;m=(p.innerText||p.textContent)+(m?" ("+m+")":"");q&&(q.innerHTML=b.speechenabled);$rs.setAttr(l,"title",m);$rs.setAttr(l,"data-readspeaker-href",n);q=$rs.getAttr(l,"data-rsevent-id");(!q||rs.l.f.eq.store[q]&&!rs.l.f.eq.store[q].click)&&$rs.regEvent(l,"click",function(){window.open($rs.getAttr(this,"data-readspeaker-href"))});if(l=$rs.findIn(l,".rsbtn_btnlabel a"))(/Chrome|Safari|Opera/gi.test(f.name)||/Explorer/gi.test(f.name)&&8<=f.version)&&$rs.regEvent(l,"click",function(h){r(h)}),
l.innerHTML='<span class="rsbtn_label_read">Read</span><span class="rsbtn_label_speaker">Speaker</span><span class="rsbtn_label_icon rsimg"></span>'}$rs.addClass(a[z],"pre-expanded");$rs.removeClass($rs.findIn(a[z],".rsbtn_progress_container"),"rsloading");$rs.regEvent($rs.findIn(a[z],".rsbtn_closer"),"click",i);$rs.regEvent($rs.findIn(a[z],".rsbtn_pause"),"click",h);$rs.regEvent($rs.findIn(a[z],".rsbtn_play"),"click",c);$rs.regEvent($rs.findIn(a[z],".rsbtn_settings"),"click",j)}};return{meta:{revision:"2828"},
initrun:!1,init:function(){evt=rspkr.Common.addEvent;ui=rspkr.ui;evt("onAfterModsLoaded",x);evt("onReady",n);evt("onReady",u);evt("onSelectedText",a);evt("onDeselectedText",f);evt("onSettingsChanged",k.update);evt("onAfterSyncInit",c);this.initrun=!0;rspkr.Common.dispatchEvent("onUIInitialized");rspkr.log("[rspkr.ui] Initialized!")},addFocusHandler:function(a,b,f){var e=b,c=f,c=c||a;void 0===e&&(e=!0);$rs.focusIn&&"function"==typeof $rs.focusIn&&($rs.focusIn(a,function(){$rs.addClass(c,"rsfocus");
!0===e&&(v=a);rspkr.Common.dispatchEvent("onFocusIn",window,[a,c])}),$rs.focusOut(a,function(){$rs.removeClass(c,"rsfocus");rspkr.Common.dispatchEvent("onFocusOut",window,[a,c])}))},focus:function(a){t(a)},updateFocus:function(){c()},showOverlay:function(a,f){var e=a,c;c=f||b.getContainer();var j=$rs.findIn(c,".rsbtn_status");0===j.length&&(j=document.createElement("span"),j.className="rsbtn_status_overlay",j.innerHTML='<span class="rsbtn_status"></span>',$rs.findIn(c,".rsbtn_exp").appendChild(j),
j=$rs.findIn(c,".rsbtn_status"));$rs.css($rs.findIn(c,".rsbtn_status_overlay"),"display","block");if("nosound"===e)e='<a class="rsbtn_nosound">'+rspkr.cfg.getPhrase("nosound")+"</a>",j.innerHTML=e,(e=$rs.findIn(c,".rsbtn_nosound"))&&$rs.regEvent(e,"click",function(){return b.nosound()});else if("loaderror"===e){var e=rspkr.c.data.getSaveData("link"),h=document.createElement("a");window.iframeLoaded=function(a){delete window.iframeLoaded;if("Explorer"!=rs.c.data.browser.name){var h=a.contentWindow.document,
b=h.head||h.getElementsByTagName("head")[0],f=document.createElement("style");f.type="text/css";f.styleSheet?f.styleSheet.cssText="pre { white-space: normal; }":f.appendChild(h.createTextNode("pre { white-space: normal; }"));b.appendChild(f);try{var g=decodeURIComponent(a.contentWindow.location.href),e=-1!=g.indexOf(" ")?g.indexOf(" "):0,c=g.lastIndexOf("/",e)+1,j=g.substr(c);h.body.innerHTML=j}catch(k){}}};h.className="rsbtn_loaderror";h.innerHTML="[?]";h.href=e;$rs.regEvent(h,"click",function(a){rspkr.ui.Lightbox.show("<iframe src='"+
h.href+"' style='height:100%' onload='window.iframeLoaded(this)'></iframe>",null,!1,null,300);r(a)});j.innerHTML=rspkr.cfg.getPhrase("loaderror");j.appendChild(h)}else j.innerHTML=e},settings:k,rsbtnClass:"",addClickEvents:function(){n()},initGlobalCallbacks:function(){x()},showPopupIcon:function(b){a(b)},processDeferred:function(){u()},showPlayer:function(a,f,c){var j;a:{var k=c;rspkr.log("[rspkr.ui.showPlayer]");k=k||!1;if("string"==typeof a)b:{for(var c=$rs.get("a"),h=0,i=c.length;h<i;h++)if(c[h].href&&
c[h].href==a){c=c[h];break b}c=!1}else c=a;if((c=(h=c)?$rs.closest(h,".rsexpanded"):void 0)&&!$rs.isArray(c)&&rspkr.ui.getActivePlayer())rspkr.log("Player already active, calling Player.restart() instead"),rspkr.ui.getActivePlayer().restart(),j=void 0;else{rspkr.c.dispatchEvent("onBeforeParamsSet",window,[h]);c="string"==typeof a?a:h.href;i=null;"string"==typeof a&&(a=c.match(/readid=[^&]+/gi),i=c.match(/readclass=[^&]+/gi),a&&0<a.length&&rspkr.HL.Restore.Storage.readId.push(a[0].replace("readid=",
"").split(",")),i&&0<i.length&&rspkr.HL.Restore.Storage.readClass.push(i[0].replace("readclass=","").split(",")));rspkr.c.data.setParams(c);void 0!==$rs.getAttr(h,"data-target")&&null!==$rs.getAttr(h,"data-target")&&(a=$rs.getAttr(h,"data-target"),a=$rs.get(a),"object"===typeof a&&(f=a));f&&!k?(i=$rs.get(f),$rs.addClass(i,rspkr.ui.rsbtnClass+" rsfloating"),rspkr.basicMode&&($rs.removeClass(i,"rshidden"),$rs.addClass(i,rspkr.ui.rsbtnClass+" rsvisible"))):i=$rs.closest(h,"div."+rspkr.ui.rsbtnClass);
if(!0===rspkr.cfg.item("survey.allowed"))if(f=rspkr.c.cookie,k=rspkr.cfg.item("survey.cookieName")||"rspkrsurvey",a=rspkr.cfg.item("survey.cookieLifetime")||15552E6,h=rspkr.c.data.params,"1"===f.readKey(k,"nmbrdisplays")){rspkr.ui.Lightbox.show(rspkr.cfg.item("survey.url")+"?customerid="+h.customerid+"&lang="+h.lang,rspkr.st.r().replaceTokens(rspkr.cfg.item("ui.survey.buttons").join(),{rsSURVEY_BUTTON_CLOSErs:rspkr.cfg.getPhrase("close")}),!0,function(){$rs.regEvent($rs.get("#rssurvey_button_close"),
"click",rspkr.u.Lightbox.hide)},500);rspkr.log(f.updateKey(k,"nmbrdisplays","displayed",a),4);j=void 0;break a}else void 0===f.readKey(k,"nmbrdisplays")&&rspkr.log(f.updateKey(k,"nmbrdisplays","1",a),4);b:{f=i;for(j in e)if(e[j]&&e[j].getContainer&&e[j].getContainer()==f){j=e[j];break b}j=new rspkr.ui.Player(f);e.push(j)}if(b&&b!=j||b&&c!==b.getHref())b.close(!0),rspkr.c.dispatchEvent("onUIClosePlayer",b.getContainer(),[0<rspkr.c.data.selectedText.length?"textsel":"nosel"]);f=(f=b)?f.getID():null;
rspkr.c.dispatchEvent("onUIShowPlayer",window,[f,j.getID()]);j.setHref(c);j.show();j=b=j}}return j},expand:function(a){_expand(a)},pointerX:0,pointerY:0,setPointerPos:function(a){rspkr.ui.pointerX=a.pageX;rspkr.ui.pointerY=a.pageY;return!0},viewport:{width:$rs.width(window),height:$rs.height(window)},popups:p,hl:function(a,b){window.setTimeout(function(){l(a,255,255,100,255,b)},200)},scroll:{INTERVAL:null,STEPS:25,scrollToElm:function(a){$rs.isVisible(a)&&this.initScroll(a)},scrollToAnchor:function(a){for(var b=
$rs.get("a"),f=null,c=0;c<b.length;c++){var e=b[c];if(e.name&&e.name==a){f=e;break}}this.initScroll(f)},initScroll:function(a){if(a){for(var b=a.offsetTop,f=a;f.offsetParent&&f.offsetParent!=document.body;)f=f.offsetParent,b+=f.offsetTop;b-=50;rs.cfg.item("ui.autoscrollOffset")&&!isNaN(rs.cfg.item("ui.autoscrollOffset"))&&(b-=rs.cfg.item("ui.autoscrollOffset"));clearInterval(rspkr.u.scroll.INTERVAL);var f=rspkr.u.scroll.getCurrentYPos(),c=parseInt((b-f)/rspkr.u.scroll.STEPS);rspkr.u.scroll.INTERVAL=
setInterval(function(){rspkr.u.scroll.scrollWindow(c,b,a)},10)}else document.location.hash=a},getCurrentYPos:function(){return document.body&&document.body.scrollTop?document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:window.pageYOffset?window.pageYOffset:0},scrollWindow:function(a,b,f){var c=rspkr.u.scroll.getCurrentYPos(),e=c<b;window.scrollTo(0,c+a);a=rspkr.u.scroll.getCurrentYPos();if(e!=a<b||c==a)window.scrollTo(0,b),clearInterval(rspkr.u.scroll.INTERVAL),
"string"==typeof f&&(location.hash=f)}},activePlayer:b,getActivePlayer:function(){return b}}}();
ReadSpeaker.ui.Slider=function(){var b=this,e={handleClass:"",width:0,height:0,left:0,top:0,steps:-1,stepsize:-1,dir:"h",initval:-1,drop:null,start:null,dragging:null,click:null,labelDragHandle:"",labelStart:"",labelEnd:"",nudge:1},p={rsid:void 0,parent:void 0,ref:void 0},w=void 0,r=void 0,n=void 0,x=void 0,u=void 0,v=!1,c=0,t=function(a){a=a||window.event;a.returnValue=!1;if(a=a.originalEvent)a.cancelBubble=!0,a.returnValue=!1;a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation()};
this.initElement=function(a){if(!v){"string"==typeof a&&(a=document.getElementById(a));a.innerHTML+='<a href="javascript:void(0);" role="slider" class="keyLink" style="display:block; border:0;">&#160;</a>';var b=a.getElementsByTagName("a"),b=b[b.length-1],j=-1<e.steps?e.steps:100;b.relatedElement=a;$rs.setAttr(b,"title",e.labelDragHandle);$rs.setAttr(b,"aria-label",e.labelDragHandle);$rs.setAttr(b,"aria-orientation","h"==e.dir?"horizontal":"vertical");$rs.setAttr(b,"aria-valuemin",0);$rs.setAttr(b,
"aria-valuemax",j);$rs.setAttr(b,"aria-valuenow",e.initval||0);c=e.initval;$rs.regEvent(a,"mousedown",this.startDragMouse);$rs.regEvent(b,"click",function(a){t(a)});$rs.regEvent(b,"keyup",this.startDragKeys);$rs.regEvent(b,"dragstart",function(a){t(a)});$rs.regEvent(a,"touchstart",this.touchStart);$rs.regEvent(p.parent,"mousedown",this.mouseClick)}};this.mouseClick=function(a){if(!v&&!$rs.hasClass(p.ref,"dragged")){var f=b.findPos(a.target),c=a.clientX-(f.left-e.left),a=a.clientY-(f.top-e.top);n=
f.left;x=f.top;f=b.getCurrentVal({left:c,top:a});"function"==typeof e.click&&e.click(f,p);return!1}};this.findPos=function(a){var b=curTop=0;if(a.offsetParent){do b+=a.offsetLeft,curTop+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:curTop}}};this.startDragMouse=function(a){rspkr.log("[rspkr.ui.Slider] startDragMouse");if(!v){b.startDrag(this);var f=a||window.event;w=f.clientX;r=f.clientY;$rs.regEvent(document.body,"mousemove",b.dragMouse);$rs.regEvent(document.body,"mouseup",b.releaseElement)}t(a);
return!1};this.startDragKeys=function(a){rspkr.log("[rspkr.ui.Slider] startDragKeys "+(a||window.event).keyCode);b.startDrag(this.relatedElement);$rs.regEvent(document.body,"keydown",b.dragKeys);$rs.regEvent(document.body,"keypress",b.switchKeyEvents);$rs.addClass(this.relatedElement,"rskeycontrolled");t(a)};this.touchStart=function(a){a=a.originalEvent;rspkr.log("[rspkr.ui.Slider] touchStart");v||(b.startDrag(a.target),w=a.touches[0].pageX,r=a.touches[0].pageY,$rs.regEvent(a.target,"touchmove",b.touchMove),
$rs.regEvent(a.target,"touchend",b.releaseElement));return!1};this.startDrag=function(a){rspkr.log("[rspkr.ui.Slider] startDrag");u&&b.releaseElement();n=a.offsetLeft;x=a.offsetTop;u=a;$rs.addClass(u,"dragged");"function"==typeof e.start&&e.start(p)};this.dragMouse=function(a){a=a||window.event;b.setPosition(a.clientX-w,a.clientY-r);b.valueChanged=!0;return!1};this.touchMove=function(a){t(a);b.setPosition(a.touches[0].pageX-w,a.touches[0].pageY-r);b.valueChanged=!0;return!1};this.dragKeys=function(a){switch((a||
window.event).keyCode){case 37:case 63234:b.valueChanged=!0;c-=e.nudge;break;case 38:case 63232:b.valueChanged=!0;c+=e.nudge;break;case 39:case 63235:b.valueChanged=!0;c+=e.nudge;break;case 40:case 63233:b.valueChanged=!0;c-=e.nudge;break;case 13:case 27:return b.releaseElement(),!1;case 9:return b.releaseElement(),!0;default:return rspkr.log("[rspkr.ui.Slider] return TRUE"),!0}!0===b.valueChanged&&(rspkr.c.dispatchEvent("onUISliderMove"),"function"==typeof e.dragging&&e.dragging(b.getCurrentVal({skipValueCalculation:!0}),
p));t(a);rspkr.log("[rspkr.ui.Slider] ready to return!");return!1};this.setPosition=function(a,f){var c,k=!1;c=a;var l=n,m=e.left,g=e.width,r="left";"v"==e.dir&&(c=f,l=x,m=e.top,g=e.height,r="top");c=l+c;-1<e.stepsize&&((c+m)%e.stepsize?c=e.stepsize*Math.ceil(c/e.stepsize)+m:k=!0);c>g+m?c=g+m:c<m&&(c=m);k||(u.style[r]=c+"px","function"==typeof e.dragging&&e.dragging(b.getCurrentVal(),p))};this.switchKeyEvents=function(){$rs.unregEvent(document.body,"keydown",b.dragKeys);$rs.unregEvent(document.body,
"keypress",b.switchKeyEvents);$rs.regEvent(document.body,"keypress",b.dragKeys)};this.releaseElement=function(){rspkr.log("[rspkr.ui.Slider] releaseElement");$rs.unregEvent(document.body,"mousemove",b.dragMouse);$rs.unregEvent(document.body,"mouseup",b.releaseElement);$rs.unregEvent(document.body,"keypress",b.dragKeys);$rs.unregEvent(document.body,"keypress",b.switchKeyEvents);$rs.unregEvent(document.body,"keydown",b.dragKeys);$rs.unregEvent(u,"touchmove",b.touchMove);$rs.unregEvent(u,"touchend",
b.releaseElement);$rs.removeClass(u,"dragged");$rs.removeClass(u,"rskeycontrolled");$rs.removeClass(u,"rsmousecontrolled");var a=b.getCurrentVal();u=null;"function"==typeof e.drop&&!0===b.valueChanged&&e.drop(a,p);b.valueChanged=!1;rs.ui.getActivePlayer().setProgress();return!1};this.getCurrentVal=function(a){var b,j=e.width;b="left";var k=e.left;"v"==e.dir&&(j=e.height,b="top",k=e.top);var l=-1<e.steps?e.steps:100,j=-1<e.stepsize?e.stepsize:j/l,a=a?a[b]:$rs.css(p.ref,b).replace(/px/i,"");pos=Math.round(a)-
k;b=Math.round(pos/j);"v"==e.dir&&(b=l-b);rspkr.log("[rspkr.ui.Slider] currentval: "+b);return a&&a.skipValueCalculation||isNaN(b)?c=Math.max(Math.min(c,l),0):c=b};return{init:function(a,f){"string"==typeof a&&(a=document.getElementById(a));if(a){var c=a.id||"data-readspeaker-slider-id-"+Math.floor(2E4*Math.random());a.setAttribute&&a.setAttribute("data-readspeaker-slider-id-","data-readspeaker-slider-parent-"+c);var k={width:function(){return $rs.width(a)},height:function(){return $rs.height(a)}};
if("object"==typeof f)for(var l in f)f.hasOwnProperty(l)&&void 0!==e[l]&&(e[l]=f[l]);l=!1;var m;"rsbtn_volume_slider"===a.className&&("jquery"===rspkr.l.f.currentLib()&&1.5>parseFloat(jQuery.fn.jquery))&&(m=a.parentNode.style.display,a.parentNode.style.display="block",l=!0);e.width=k.width();e.height=k.height();l&&(a.parentNode.style.display=m);-1<e.steps&&(e.stepsize=("h"==e.dir?e.width:e.height)/e.steps);k=document.createElement("span");k.setAttribute("data-readspeaker-slider-id-",c);k.className=
e.handleClass||"rsbtn_progress_handle rsimg";a.appendChild(k);p.rsid=c;p.parent=a;p.ref=k;c=$rs.css(k,"left");null!==c&&(e.left=parseInt(c.replace(/px/i,"")));c=$rs.css(k,"top");null!==c&&(e.top=parseInt(c.replace(/px/i,"")));-1<e.initval&&this.jumpTo(e.initval);e.labelStart&&(c=document.createElement("span"),c.className="slider-label-start",c.innerHTML=e.labelStart,a.appendChild(c));e.labelEnd&&(c=document.createElement("span"),c.className="slider-label-end",c.innerHTML=e.labelEnd,a.appendChild(c));
b.initElement(k)}},jumpTo:function(a){if(isNaN(a))return!1;var b=101,c=a;-1<e.steps&&(a=Math.round(a),b=e.steps+1);if(-1<a&&a<b){var k=e.width,l=e.left,m="left";"v"==e.dir&&(k=e.height,l=e.top,m="top",a=b-1-a);p.ref.style[m]=k/(b-1)*a+l+"px";$rs.setAttr($rs.findIn(p.ref,"a.keyLink"),"aria-valuenow",c)}},setCurrentValue:function(a){c=a},getInstance:function(){return p},getContainer:function(){return p.parent},releaseElement:function(){b.releaseElement()},startDragKeys:function(a,c){b.startDragKeys.call(a,
c)},disabled:function(){if(arguments)v=arguments[0];else return v}}};
ReadSpeaker.ui.Player=function(b){var e=function(a){a=a||window.event;a.returnValue=!1;if(a=a.originalEvent)a.cancelBubble=!0,a.returnValue=!1;a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation()},p=rspkr.getID(),w=this,r=[],n=0,x=!1,u=null,v=!1,c={_play:null,_pause:null,_stop:null,_vol:null,_settings:null,_dl:null,_closer:null,_powered:null,_get:function(a,c){var f,a="_"+a;f=b?this[a]&&0<this[a].length?this[a]:this[a]=$rs.findIn(b,c):null;return f==[]?null:f},play:function(){return this._get("play",
".rsbtn_play")},pause:function(){return this._get("pause",".rsbtn_pause")},stop:function(){return this._get("stop",".rsbtn_stop")},vol:function(){return this._get("vol",".rsbtn_volume")},settings:function(){return this._get("settings",".rsbtn_settings")},dl:function(){return this._get("dl",".rsbtn_dl")},pin:function(){return this._get("pin",".rsbtn_pin")},powered:function(){return this._get("powered",".rsbtn_powered")},closer:function(){return this._get("closer",".rsbtn_closer")},nosound:function(){return this._get("nosound",
".rsbtn_nosound")},setPlayPause:function(a){rspkr.log("[rspkr.ui.Player.setPlayPause("+a+")]");a=a?$rs.getAttr(this.pause(),"data-rsphrase-play"):$rs.getAttr(this.pause(),"data-rsphrase-pause");$rs.setAttr(this.pause(),"title",rspkr.c.decodeEntities(a));$rs.findIn(this.pause(),".rsbtn_btnlabel").innerHTML=a}},t=!1,a=[],f={play:function(){rspkr.c.dispatchEvent("onUIBeforePlay");rspkr.log("[rspkr.ui.handlers.play]");a.progress&&a.progress.disabled(!1);f.setStateClass(b,"rsplaying");rspkr.basicMode&&
f.setStateClass($rs.findIn(b,".rsbtn_exp"),"rsplaying");$rs.addClass($rs.findIn(b,".rsbtn_progress_container"),"rsloading");c.setPlayPause(!1);rspkr.pl.play();v&&rspkr.pl.getProgress.apply(rspkr.pl,[!0,k,w]);rspkr.c.addEvent("onBeforeSyncInit",function(){v=!0;rspkr.pl.getProgress.apply(rspkr.pl,[!0,k,w])});"flash"===rspkr.pl.adapter&&!rspkr.displog.onVolumeAdjusted&&rspkr.pl.setVolume(parseInt(rspkr.st.get("hlvol")||"100"));rspkr.c.dispatchEvent("onUIAfterPlay");rspkr.cfg.execCallback("cb.ui.play",
b)},pause:function(){rspkr.log("[rspkr.ui.handlers.pause]");f.setStateClass(b,"rspaused");rspkr.basicMode&&f.setStateClass($rs.findIn(b,".rsbtn_exp"),"rspaused");c.setPlayPause(!0);rspkr.pl.pause();rspkr.pl.getProgress(!1);rspkr.c.dispatchEvent("onUIPause");rspkr.cfg.execCallback("cb.ui.pause",b);rspkr.log("ReadSpeaker.ui.pause")},stop:function(){rspkr.log("[rspkr.ui.handlers.stop]");a.progress&&a.progress.disabled(!0);f.setStateClass(b,"rsstopped");$rs.removeClass($rs.findIn(b,".rsbtn_progress_container"),
"rsloading");rspkr.basicMode&&f.setStateClass($rs.findIn(b,".rsbtn_exp"),"rsstopped");c.setPlayPause(!0);$rs.setAttr(b,"data-readspeaker-current",0);a.progress&&(a.progress.jumpTo(0),j(0));rspkr.pl.stop();rspkr.pl.getProgress(!1);rspkr.c.dispatchEvent("onUIStop",b);rspkr.cfg.execCallback("cb.ui.stop",b);(!document.getElementById("rslightbox_contentcontainer")||!$rs.isVisible(document.getElementById("rslightbox_contentcontainer")))&&c.pause().focus();rspkr.log("ReadSpeaker.ui.stop")},setStateClass:function(a,
b){a&&($rs.removeClass(a,"rspaused rsstopped rsplaying"),$rs.addClass(a,b))},vol:function(h){var c=$rs.findIn(b,".rsbtn_volume_container"),f=$rs.findIn(b,".rsbtn_volume"),h=h.originalEvent,e=function(a){var b=a.originalEvent,b=$rs.closest(b.srcElement||b.originalTarget,".rsbtn_volume_container");if("none"===$rs.css(c,"display"))return!1;if("click"===a.type){if(void 0===b||$rs.isArray(b)&&!b.length)$rs.css(c,"display","none"),$rs.unregEvent(document.body,"click",e)}else"keyup"===a.type&&27===a.keyCode&&
($rs.css(c,"display","none"),$rs.unregEvent(document.body,"keyup",e))};$rs.css(c,"left",f.offsetLeft+"px");$rs.css(c,"display","none"==$rs.css(c,"display")?"block":"none");"block"===$rs.css(c,"display")&&($rs.regEvent(document.body,"click",e),$rs.regEvent(document.body,"keyup",e));h&&h.stopPropagation&&h.stopPropagation();h.cancelBubble=!0;f=$rs.findIn(c,".keyLink");a.vol.startDragKeys(f,{keyCode:13});return!1},settings:function(){$rs.hasClass(b,"rsplaying")&&this.pause();rspkr.ui.Lightbox.show(rspkr.st.getHTML(),
rspkr.st.getButtons(),!0,function(a){var b=$rs.get("rslightbox_closer"),c=function(){document.removeEventListener?b.removeEventListener("click",c,!1):document.detachEvent&&document.detachEvent("onclick",c);rspkr.c.dispatchEvent("onSettingsClosed",window,[])};$rs.regEvent(b,"click",c);rspkr.ui.addClickEvents();rspkr.c.dispatchEvent("onSettingsLoaded",window,[]);rspkr.cfg.execCallback("cb.ui.settingsopened",a)})},close:function(h){f.pin(!0);var h=h||!1,e=rspkr.pl,g=!1;h||rspkr.cfg.execCallback("cb.ui.beforeclose",
b);e.hasOwnProperty("getProgress")&&rspkr.pl.getProgress(!1);e.hasOwnProperty("releaseAdapter")&&rspkr.pl.releaseAdapter();$rs.setAttr(b,"data-readspeaker-current",0);a.progress&&a.progress.jumpTo(0);$rs.removeClass(b,"rsstopped rsplaying rspaused rsexpanded");if(rspkr.basicMode){var j;(j=$rs.findIn(b,".rsbtn_play"))&&$rs.removeClass(j,"rsexpanded")}$rs.hasClass(b,"rsfloating")&&($rs.removeClass(b,rspkr.ui.rsbtnClass),rspkr.basicMode&&($rs.removeClass(b,"rsvisible"),$rs.addClass(b,"rshidden")));c.setPlayPause(!0);
$rs.hasClass(b,"rspopup")&&(g=!0,$rs.removeClass(b,"rspopup"),$rs.css(b,"display","none"),b.parentNode.removeChild(b));$rs.css(b,"width","auto");delete rspkr.displog.onVolumeAdjusted;h||(rspkr.c.dispatchEvent("onUIClosePlayer",b,["userclick"]),rspkr.cfg.execCallback("cb.ui.close",b),rspkr.log("ReadSpeaker.ui.close: "+b));!h&&!1===g&&rspkr.ui.focus($rs.findIn($rs.get(b),".rsbtn_play"))},dl:function(){$rs.hasClass(b,"rsplaying")&&this.pause();var a=rspkr.c.data.getSaveData("dialog"),c=!1;rspkr.log("[rspkr.ui.handlers.dl] Savelink: "+
a);rspkr.u.Lightbox.show(this.getDlDialog(),this.getDlButtons(),!0,function(){var b=$rs.get("#rsdl_button_accept"),f=$rs.get("#rsdl_button_decline");b&&$rs.regEvent(b,"click",function(f){rspkr.u.Lightbox.hide(f);c="iOS"!==rspkr.c.data.browser.OS&&0<rspkr.c.data.selectedHTML.length?!0:"iOS"!==rspkr.c.data.browser.OS&&!0===rspkr.cfg.item("general.usePost")?!0:!1;if(!0===c){f=null;if(document.getElementById("dliframe"))f=document.getElementById("dliframe");else{if(document.selection)try{f=document.createElement('<iframe name="dliframe">')}catch(e){f=
document.createElement("iframe")}else f=document.createElement("iframe");f.name="dliframe";f.setAttribute("id","dliframe");f.setAttribute("style","display: none; position: absolute;");f.style.display="none";var g=document.getElementsByTagName("body"),j=null;0<g.length&&(j=g.item(0));if(j)j.appendChild(f);else return}f.src=a;return!1}$rs.setAttr(b,"href",a);return!0});f&&($rs.regEvent(f,"click",function(a){e(a);rspkr.u.Lightbox.hide(a)}),setTimeout(function(){rspkr.ui.focus(f)},200));rspkr.c.dispatchEvent("onDownloadLoaded",
window,[])})},pin:function(a){var b=rs.ui.getActivePlayer().getContainer(),f=b.id+"_pinnedHome",e=document.getElementById(f);if(!$rs.hasClass(c.pin(),"pinned")&&!a){if($rs.addClass(c.pin(),"pinned"),!e){var e=$rs.clone(b,!1,!0),a=window.getComputedStyle(b),g=b.offsetLeft,j=b.offsetTop;e.style.width=a.getPropertyValue("width").replace(/[^-\d\.]/g,"")-2+"px";e.style.height=a.getPropertyValue("height").replace(/[^-\d\.]/g,"")-2+"px";for(var k="position left right top bottom margin".split(" "),l=0,m;m=
k[l];l++)e.style[m]=a.getPropertyValue(m);b.style.position="fixed";b.style.left=g-document.body.scrollLeft+"px";b.style.top=j-document.body.scrollTop+"px";e.className="rsbtn_pinnedHome rsbtn";for(e.id=f;e.hasChildNodes();)e.removeChild(e.lastChild);b.parentElement.insertBefore(e,b)}}else if($rs.hasClass(c.pin(),"pinned")||a)$rs.removeClass(c.pin(),"pinned"),e&&(e.parentNode.removeChild(e),f=function(a,b){document.body.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(b)},f(b,
"position"),f(b,"top"),f(b,"left"))},getDlDialog:function(){var a=rspkr.cfg.item("ui.dldialog").join("\n"),b={};b.rsTERMS_OF_USE_HEADINGrs=rspkr.cfg.getPhrase("touheading");b.rsTERMS_OF_USE_BODYrs=rspkr.cfg.getPhrase("toubody");return rspkr.st.r().replaceTokens(a,b)},getDlButtons:function(){var a=rspkr.cfg.item("ui.dlbuttons").join("\n"),b={};b.rsTERMS_OF_USE_ACCEPTrs=rspkr.cfg.getPhrase("touaccept");b.rsTERMS_OF_USE_DECLINErs=rspkr.cfg.getPhrase("toudecline");return rspkr.st.r().replaceTokens(a,
b)},nosound:function(){var a=rspkr.c.data.getSaveData("link");$rs.setAttr(c.nosound(),"href",a);return!0}},j=function(a){var a=100<a?100:a,c=$rs.findIn(b,".rsbtn_progress_played");"object"===typeof c&&$rs.css(c,"width",a+"%");rspkr.cfg.execCallback("cb.ui.progresschanged",b,[a])},k=function(c){if(c.length){var f=parseInt(c[0]),c=parseInt(c[1]),e=0==c?0:Math.round(100*(f/c)),g=$rs.findIn(b,".rsbtn_current_time"),k=$rs.findIn(b,".rsbtn_total_time"),m,n;a.progress&&(a.progress.setCurrentValue(e),t||
(a.progress.jumpTo(e),j(e),g&&(g.innerHTML=m=l(f)),k&&(k.innerHTML=n=l(c)),rspkr.cfg.execCallback("cb.ui.timeupdated",b,[m,n])));rspkr.log("[rspkr.player.updateProgress] current time: "+f+" total time: "+c);$rs.setAttr(b,"data-readspeaker-current",f);$rs.setAttr(b,"data-readspeaker-buffered",c);0<f&&$rs.removeClass($rs.findIn(b,".rsbtn_progress_container"),"rsloading")}},l=function(a){var a=a/1E3,b=parseInt(a%60),c=parseInt(a/60%60),a=parseInt(a/60/60%60);return(10>a?"0"+a:a.toString())+":"+(10>c?
"0"+c:c.toString())+":"+(10>b?"0"+b:b.toString())},m=function(){t=!0},g=function(a){rspkr.log("_dropProgress ("+a+")",5);a&&(a=a/100*$rs.getAttr(b,"data-readspeaker-buffered")/1E3,rspkr.pl.setProgress(a));t=!1},C=function(a){g(a)},y=function(c){rspkr.log("_dropVolume, "+c,5);c=0>c?0:20*c;a.vol&&a.vol.jumpTo(c/20);rspkr.pl.setVolume(c);rspkr.st.set("hlvol",c);rspkr.cfg.execCallback("cb.ui.volumechanged",b,[c]);return!1},B=function(c,f){if("keyLink"===c.className){var e="";$rs.hasClass(f,"rsbtn_volume_handle")?
e="vol":$rs.hasClass(f,"rsbtn_progress_handle")&&(e="progress");var g={keyCode:13};a[e].startDragKeys(c,g)}else $rs.hasClass(f,"rsbtn_volume")&&(g={keyCode:13},e=$rs.findIn(b,".rsbtn_volume_container"),e=$rs.findIn(e,".keyLink"),a.vol.startDragKeys(e,g))},A=function(b,c){if("keyLink"===b.className){var f="";$rs.hasClass(c,"rsbtn_volume_handle")?f="vol":$rs.hasClass(c,"rsbtn_progress_handle")&&(f="progress");a[f].releaseElement();t=!1}};return{init:function(){r.push([this.show,[]])},show:function(){$rs.rsid(b);
b.id=p=b.id||rspkr.getID();ui=rspkr.ui;$rs.hasClass(b,rspkr.ui.rsbtnClass)||$rs.addClass(b,rspkr.ui.rsbtnClass);var h=null,h=rspkr.cfg,i=rspkr.cfg.getPhrases(rspkr.c.data.getParam("lang"));if(0==$rs.findIn(b,".rsbtn_exp").length){var j=$rs.hasClass(b,"rspopup")?h.item("ui.popupplayer"):h.item("ui.player"),h=document.createElement("div");h.className="rsbtn_exp rsimg rspart";h.innerHTML+=j.join("\n");b.appendChild(h)}"fallback"===rspkr.pl.adapter&&rspkr.ui.showOverlay("nosound",b);h=c.pin();$rs.isArray(h)&&
0==h.length&&(h=void 0);rspkr.cfg.item("ui.usePin")&&h?$rs.removeClass(h,"turnedOff"):h&&h.parentElement.removeChild(h);if(i){h=function(a,b){var c=$rs.findIn(a,".rsbtn_btnlabel");$rs.isArray(c)||(c=[c]);0<c.length&&(c[0].innerHTML=b)};c.pause()&&($rs.setAttr(c.pause(),"data-rsphrase-pause",i.pause),$rs.setAttr(c.pause(),"data-rsphrase-play",i.play),$rs.setAttr(c.pause(),"title",rspkr.c.decodeEntities(i.pause)),h(c.pause(),rspkr.c.decodeEntities(i.pause)));c.stop()&&($rs.setAttr(c.stop(),"title",
rspkr.c.decodeEntities(i.stop)),h(c.stop(),rspkr.c.decodeEntities(i.stop)));c.vol()&&($rs.setAttr(c.vol(),"title",rspkr.c.decodeEntities(i.volume)),h(c.vol(),rspkr.c.decodeEntities(i.volume)));c.settings()&&($rs.setAttr(c.settings(),"title",rspkr.c.decodeEntities(i.settings)),h(c.settings(),rspkr.c.decodeEntities(i.settings)));c.dl()&&($rs.setAttr(c.dl(),"title",rspkr.c.decodeEntities(i.download)),h(c.dl(),rspkr.c.decodeEntities(i.download)));if(c.powered()){var j=$rs.findIn(c.powered(),".rsbtn_btnlabel"),
k=i.speechenabled.match(/.*href="([^"]*)"/i).pop(),l=i.newwindow,r=document.createElement("p");r.innerHTML=i.speechenabled;l=(r.innerText||r.textContent)+(l?" ("+l+")":"");j&&(j.innerHTML=i.speechenabled);$rs.setAttr(c.powered(),"title",l);$rs.setAttr(c.powered(),"data-readspeaker-href",k);j=$rs.getAttr(c.powered(),"data-rsevent-id");(!j||rs.l.f.eq.store[j]&&!rs.l.f.eq.store[j].click)&&$rs.regEvent(c.powered(),"click",function(){window.open($rs.getAttr(this,"data-readspeaker-href"))})}c.closer()&&
($rs.setAttr(c.closer(),"title",rspkr.c.decodeEntities(i.closeplayer)),h(c.closer(),rspkr.c.decodeEntities(i.closeplayer)))}i=rspkr.c.data.browser;(!/safari/i.test(i.name)||!/iphone|ipad|ios/i.test(i.OS))&&$rs.addClass(b,"rs-no-touch");i=$rs.findIn(b,".rsbtn_status_overlay");$rs.isArray(i)||$rs.css(i,"display","none");$rs.addClass(b,"rsexpanded");if(rspkr.basicMode){var q;(q=$rs.findIn(b,".rsbtn_play"))&&$rs.addClass(q,"rsexpanded")}x||(c.stop()&&($rs.regEvent(c.stop(),"click",function(a){e(a);f.stop()}),
ui.addFocusHandler(c.stop())),c.pause()&&($rs.regEvent(c.pause(),"click",function(a){e(a);$rs.hasClass(b,"rsplaying")?f.pause():($rs.hasClass(b,"rsstopped")||$rs.hasClass(b,"rspaused"))&&f.play()}),ui.addFocusHandler(c.pause())),c.closer()&&($rs.regEvent(c.closer(),"click",function(a){e(a);f.close()}),ui.addFocusHandler(c.closer())),c.vol()&&($rs.regEvent(c.vol(),"click",function(a){e(a);f.vol(a)}),ui.addFocusHandler(c.vol())),c.dl()&&($rs.regEvent(c.dl(),"click",function(a){e(a);return f.dl()}),
ui.addFocusHandler(c.dl())),c.settings()&&($rs.regEvent(c.settings(),"click",function(a){e(a);f.settings()}),ui.addFocusHandler(c.settings())),c.pin()&&($rs.regEvent(c.pin(),"click",function(a){e(a);f.pin()}),ui.addFocusHandler(c.pin())),q=rspkr.cfg,$rs.setAttr(b,"data-readspeaker-current",0),$rs.setAttr(b,"data-readspeaker-buffered",0),$rs.isArray($rs.findIn($rs.get(b),".rsbtn_progress_container"))||(a.progress=new rspkr.ui.Slider,a.progress.init($rs.findIn($rs.get(b),".rsbtn_progress_container"),
{handleClass:q.item("ui.progressHandleClass")||"rsbtn_progress_handle rsimg",dir:q.item("ui.progressDir")||"h",nudge:5,start:m,dragging:g,click:C,labelDragHandle:q.getPhrase("sliderseek")}),i=$rs.findIn($rs.get(b),".rsbtn_progress_handle a"),ui.addFocusHandler(i,!1,i.parentNode)),$rs.isArray($rs.findIn($rs.get(b),".rsbtn_volume_slider"))||(i=rspkr.st.get("hlvol")||"100",i=5*(parseInt(i)/100),a.vol=new rspkr.ui.Slider,a.vol.init($rs.findIn(b,".rsbtn_volume_slider"),{handleClass:q.item("ui.volumeHandleClass")||
"rsbtn_volume_handle rsimg",dir:q.item("ui.volumeDir")||"v",steps:5,nudge:1,initval:i,dragging:y,click:y,labelDragHandle:q.getPhrase("slidervolumedesc")}),i=$rs.findIn($rs.get(b),".rsbtn_volume_handle a"),ui.addFocusHandler(i,!1,i.parentNode)),rspkr.Common.addEvent("onFocusIn",B),rspkr.Common.addEvent("onFocusOut",A),rspkr.cfg.execCallback("cb.ui.open",b),x=!0);if($rs.findIn(b,".rsbtn_powered")&&(q=$rs.findIn(b,".rsbtn_powered .rsbtn_btnlabel a")))(/Chrome|Safari|Opera/gi.test(rs.c.data.browser.name)||
/Explorer/gi.test(rs.c.data.browser.name)&&8<=rs.c.data.browser.version)&&$rs.regEvent(q,"click",function(a){e(a)}),q.innerHTML='<span class="rsbtn_label_read">Read</span><span class="rsbtn_label_speaker">Speaker</span><span class="rsbtn_label_icon rsimg"></span>';"0"!=$rs.getAttr(b,"data-readspeaker-current")&&(rspkr.pl.releaseAdapter(),$rs.setAttr(b,"data-readspeaker-current",0));"fallback"!==rspkr.pl.adapter&&(f.play(),rspkr.ui.focus(c.pause()));q=(q=b)||b;q=$rs.clone(q,!0,!0);q.id=rspkr.getID();
document.body.appendChild(q);$rs.css(q,{position:"absolute",top:"0",left:"0",display:"block",width:"auto"});$rs.css(q,"float","none");$rs.addClass(q,"rsexpanded");i=$rs.outerWidth(q)+3;q.style.display="none";document.body.removeChild(q);n=i;isNaN(n)||$rs.css(b,"width",n+(/[Ee]xplorer/.test(ReadSpeaker.c.data.browser.name)?1:0)+"px")},close:function(a){f.close(a)},stop:function(){f.stop()},nosound:function(){return f.nosound()},pause:function(){f.pause()},play:function(){f.play()},restart:function(){rspkr.log("[rspkr.ui.restart]");
f.stop();window.setTimeout(function(){f.play()},500);return!1},updateProgress:function(a){k(a)},setProgress:function(a){g(a)},getContainer:function(){return b},getID:function(){return p},getWidth:function(){return n},setHref:function(a){u=a},getHref:function(){return u}}};
ReadSpeaker.ui.Lightbox=function(){var b=null,e=null,p=null,w=null,r=null,n=null,x,u=[],v=function(a){a=a||window.event;a.returnValue=!1;if(a=a.originalEvent)a.cancelBubble=!0,a.returnValue=!1;a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation()},c=function(){$rs.css(n,"display","none");var a=$rs.height(window),b=$rs.height(document),c=parseInt($rs.css(document.documentElement,"width")),e=$rs.width(document),m=$rs.absOffset(document.body),g=0,p=0;isNaN(c)&&(c=$rs.width(window));
m.left&&(p=m.left);m.top&&(g=m.top);$rs.css(r,{width:(e>c?e:c)+"px",height:(b>a?b:a)+"px",top:"-"+Math.abs(g)+"px",left:"-"+Math.abs(p)+"px"});$rs.css(n,"display","block");t()},t=function(){var a=$rs.outerWidth(n),b=$rs.outerHeight(n),c=$rs.width(window),e=$rs.height(window),b=x+80+50<e?x+80:e-50;n.style.height=b+"px";$rs.get("#rslightbox_content").style.height=b-80+"px";b>e?(n.style.top=$rs.scrollTop(document)+"px",n.style.marginTop="10px"):(n.style.top=e/2+"px",n.style.marginTop=-(b/2-$rs.scrollTop(document))+
"px");a>c?(n.style.left=$rs.scrollLeft(document)+"px",n.style.marginLeft="0"):(n.style.left="50%",n.style.marginLeft=-(a/2-$rs.scrollLeft(document))+"px")},a=function(a){27===a.keyCode&&rspkr.ui.Lightbox.hide()};return{init:function(){var a=rspkr.pub.Config;b=a.item("ui.overlay.overlayStyles");e=a.item("ui.overlay.contentStyles");p=a.item("ui.overlay.contentTemplate");document.querySelectorAll||(d=document,s=d.createStyleSheet(),d.querySelectorAll=function(a,b,c,f,e){e=d.all;b=[];a=a.replace(/\[for\b/gi,
"[htmlFor").split(",");for(c=a.length;c--;){s.addRule(a[c],"k:v");for(f=e.length;f--;)e[f].currentStyle.k&&b.push(e[f]);s.removeRule(0)}return b});rspkr.log("[rspkr.ui.Lightbox] Heartbeat!")},show:function(f,j,k,l,m){for(var g=0,t=document.body.getElementsByTagName("*"),y;y=t[g];g++)-1!=y.tabIndex&&(u.push([y,y.tabIndex]),y.tabIndex=-1);y=document.querySelectorAll("body > *");for(g=0;t=y[g];g++)if(!("rslightbox_overlay"==t.id||"rslightbox_contentcontainer"==t.id||"script"==t.tagName.toLowerCase())){var B=
t.getAttribute("aria-hidden");B&&t.setAttribute("data-original-aria-hidden",B);t.setAttribute("aria-hidden","true")}f=f||"";k=k||!1;r?(r.style.display="",n.style.display=""):(r=document.createElement("div"),r.id="rslightbox_overlay",n=document.createElement("div"),n.id="rslightbox_contentcontainer",n.innerHTML=rspkr.st.r().replaceTokens(p.join("\n"),{rsLIGHTBOX_CLOSE_LABELrs:rspkr.cfg.getPhrase("close")}),$rs.setAttr(r,"style",b.join(";")),$rs.setAttr(n,"style",e.join(";")),document.body.appendChild(r),
document.body.appendChild(n),rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.changed.addButtonEvents,context:rspkr.st.r().handlers.changed,params:[this]}));g=$rs.get("rslightbox_closer");rspkr.ui.addFocusHandler(g,!1);$rs.regEvent(g,"click",function(a){v(a);rspkr.ui.Lightbox.hide(a)});$rs.regEvent(r,"click",rspkr.ui.Lightbox.hide);$rs.regEvent(document.body,"keyup",a);if((g=document.documentElement)&&document.all)g.style.overflowX=g.style.overflowY="hidden";if(f!=w||k)$rs.get("#rslightbox_content").innerHTML=
"",$rs.css("#rslightbox_content","height","auto"),/^http/i.test(f)?$rs.findIn("#rslightbox_content","iframe").length||(k=document.createElement("iframe"),k.src=f,k.className="rslightbox-iframe",void 0===m&&(m=2E3),$rs.get("#rslightbox_content").appendChild(k)):"<"==f.substr(0,1)&&($rs.get("#rslightbox_content").innerHTML=f),$rs.get("#rslightbox_buttons").innerHTML=j,w=f;x=void 0!==m&&!isNaN(m)?m:!rspkr.basicMode?$rs.get("#rslightbox_content").clientHeight:$rs.get("#rslightbox_content").scrollHeight;
f=$rs.findIn("#rslightbox_content",".rsform-row");for(g=0;g<f.length;g++){j=$rs.findIn(f[g],"input, a, select");$rs.isArray(j)||(j=[j]);for(t=0;t<j.length;t++)rspkr.ui.addFocusHandler(j[t],!1,f[g])}var A=$rs.findIn("#rslightbox_buttons",".rssettings-button-close");rspkr.ui.addFocusHandler(A,!1);$rs.regEvent(A,"click",function(a){v(a)});(f=$rs.findIn("#rsform_wrapper",".rssettings-button-gotobottom"))&&!$rs.isArray(f)&&rspkr.ui.addFocusHandler(f,!1);(f=$rs.findIn("#rslightbox_buttons",".rssettings-button-gototop"))&&
!$rs.isArray(f)&&rspkr.ui.addFocusHandler(f,!1);var h=$rs.findIn("#rslightbox_content","input");$rs.isArray(h)&&0<h.length?setTimeout(function(){rspkr.ui.focus(h[0]);rspkr.Common.addEvent("onFocusIn",function(a){a.className&&$rs.hasClass(a,"rssettings-button-gototop")?rspkr.ui.focus(h[0]):a.className&&$rs.hasClass(a,"rssettings-button-gotobottom")&&rspkr.ui.focus(A)})},200):$rs.isArray(h)||setTimeout(function(){rspkr.ui.focus(h)},200);c();$rs.regEvent(window,"resize",c);"function"==typeof l&&l.apply(this,
[n])},hide:function(b){for(;0<u.length;)b=u.pop(),b[0].tabIndex=b[1];for(var b=document.querySelectorAll("body > *"),e=0,k;k=b[e];e++){var l=k.getAttribute("data-original-aria-hidden");l?(k.setAttribute("aria-hidden",l),k.removeAttribute("data-original-aria-hidden")):k.removeAttribute("aria-hidden")}v(b);r.style.display="none";n.style.display="none";$rs.unregEvent(window,"resize",c);$rs.unregEvent($rs.get("#rslightbox_closer"),"click",rspkr.ui.Lightbox.hide);$rs.unregEvent(r,"click",rspkr.ui.Lightbox.hide);
$rs.unregEvent(document.body,"keyup",a);if((b=document.documentElement)&&document.all)b.style.overflowX=b.style.overflowY="auto";rspkr.ui.updateFocus();rspkr.c.dispatchEvent("onSettingsClosed",window,[])},reposition:t}}();
